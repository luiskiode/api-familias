<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iniciar Sesión - Cáritas CNC</title>
  <link rel="stylesheet" href="styles.css?v=2" />

  <!-- Unificación a Firebase compat v10 -->
  <script defer src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script defer src="firebase-config.js"></script>
</head>
<body class="login-body">
  <main class="login-container" role="main">
    <h1>Cáritas CNC</h1>
    <h2>Iniciar sesión</h2>

    <form id="loginForm" autocomplete="on" novalidate>
      <label for="email">Correo</label>
      <input type="email" id="email" autocomplete="username" required />

      <label for="password">Contraseña</label>
      <input type="password" id="password" autocomplete="current-password" required />

      <button type="submit" class="submit-btn">Ingresar</button>
    </form>
    <p id="loginMessage" role="alert" aria-live="polite"></p>

    <div style="text-align:center; margin-top:.5rem;">
      <a href="#" onclick="resetPass();return false;">¿Olvidaste tu contraseña?</a>
    </div>
  </main>

  <script>
  // Login simple con Firebase Auth (compat)
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const msg = document.getElementById('loginMessage');
    msg.textContent = '';
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    try{
      await firebase.auth().signInWithEmailAndPassword(email, password);
      msg.style.color = '#0a7b2e';
      msg.textContent = '✔ Acceso concedido. Redirigiendo…';
      window.location.href = 'index.html';
    }catch(err){
      msg.style.color = '#b00020';
      msg.textContent = '❌ ' + (err?.message || 'No se pudo iniciar sesión');
      console.error(err);
    }
  });

  async function resetPass(){
    const email = prompt('Ingresa tu correo para recuperar la contraseña:');
    if(!email) return;
    try{
      await firebase.auth().sendPasswordResetEmail(email);
      alert('Hemos enviado un enlace de recuperación si el correo existe.');
    }catch(err){
      alert('No se pudo enviar el correo de recuperación.');
      console.error(err);
    }
  }
  </script>
</body>
</html>