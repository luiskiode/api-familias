<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iniciar SesiÃ³n - CÃ¡ritas CNC</title>
  <link rel="stylesheet" href="styles.css?v=2" />

  <!-- Firebase compat v10 -->
  <script defer src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script defer src="firebase-config.js"></script>
</head>
<body class="login-body">
  <main class="login-container" role="main">
    <h1>CÃ¡ritas CNC</h1>
    <h2>Iniciar sesiÃ³n</h2>

    <form id="loginForm" autocomplete="on" novalidate>
      <label for="email">Correo</label>
      <input type="email" id="email" autocomplete="username" required />

      <label for="password">ContraseÃ±a</label>
      <input type="password" id="password" autocomplete="current-password" required />

      <button type="submit" class="submit-btn">Ingresar</button>
    </form>
    <p id="loginMessage" role="alert" aria-live="polite"></p>

    <div style="text-align:center; margin-top:.5rem;">
      <a href="#" onclick="resetPass();return false;">Â¿Olvidaste tu contraseÃ±a?</a>
    </div>
  </main>

  <script>
  // Login con Firebase Auth (compat)
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const msg = document.getElementById('loginMessage');
    msg.textContent = '';
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    try {
      await firebase.auth().signInWithEmailAndPassword(email, password);
      msg.style.color = '#0a7b2e';
      msg.textContent = 'âœ” Acceso concedido. Redirigiendoâ€¦';
      setTimeout(() => window.location.href = 'index.html', 1000);
    } catch (err) {
      msg.style.color = '#b00020';
      msg.textContent = 'âŒ ' + (err?.message || 'No se pudo iniciar sesiÃ³n');
      console.error(err);
    }
  });

  async function resetPass(){
    const email = prompt('Ingresa tu correo para recuperar la contraseÃ±a:');
    if (!email) return;
    try {
      await firebase.auth().sendPasswordResetEmail(email);
      alert('ğŸ“© Si el correo existe, se enviÃ³ un enlace de recuperaciÃ³n.');
    } catch (err) {
      alert('âŒ No se pudo enviar el correo de recuperaciÃ³n.');
      console.error(err);
    }
  }
  </script>
</body>
</html>
